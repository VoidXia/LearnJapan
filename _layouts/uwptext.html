---
layout: uwp
---

<style>
.tags {
  position: fixed;
  top: 0px;
}
.tags a {
  background: white;
}
.tags a.toggle-lesson.active {
  background: wheat;
}
.japan.collapse {
  display: none;
}
.japan.hideruby ruby rt {
  color: white;
}
.japan.hideruby ruby rt:hover {
  color: inherit;
}
</style>
<div class="tags">
  <a class="toggle-ruby" href="#">注音</a>
  <a class="toggle-japan" href="#">原文</a>
  <audio id="player" controls>
  </audio>
</div>
<script>
$(document).ready(function() {
  var player = $('#player').get(0);
  player.src = "{{ site.baseurl }}/assets/audio/lesson/l" + {{page.lesson}} + ".mp3";
  player.load();
  $('a.toggle-japan').on('click', function(e) {
    e.preventDefault();
    $('.japan').toggleClass("collapse");
  });
  $('a.toggle-ruby').on('click', function(e) {
    e.preventDefault();
    $('.japan').toggleClass("hideruby");
  });

  $('li').add('h1').add('h2').add('p').each(function() {
    $(this).html(japanruby($(this).html()));
  });
});
</script>

<script>
$(document).ready(function() {
  $('.lesson>:not(.japan) li').each(function() {
    var jp = $(this).closest('.lesson').find('.japan');
    var listno = $(this).parentsUntil('.lesson').last().index();
    var itemno = $(this).index();
    var citem = jp.children().eq(listno);
    if (citem.prop('tagName').toLowerCase() != 'ul') citem = citem.find('ul');
    citem = citem.children().eq(itemno);
    if (citem.length == 0) console.log($(this).text() + " not found.");

    var t = citem.contents().clone();
    t = t.unwrap().wrap('<div class="japan translation"/>').parent();
    t.find('rt').remove();

    var button = $('<button class="translate" />')
    button.on('click', function () {
      $(this).parent().find('div.input').toggleClass('active');
    });
    var inputdiv = $('<div class="input" />')
    var input = $('<input type="textbox" class="translate" />')
    var inputbutton = $('<button class="translate" />')
    inputbutton.on('click', function () {
      $(this).parent().parent().find('.japan.translation').toggleClass('active');
    });
    inputdiv.append(input);
    inputdiv.append(inputbutton);

    $(this).append(button);
    $(this).append(inputdiv);
    $(this).append(t);
  });
  $('li:contains("-")').hide();
});

</script>
<style>
div.input.active {
  display: block;
}
div.input {
  display: none;
}
div.input input {
  width: 95%;
}
div.translation.active {
  display: inherit;
}
div.translation {
  display: none;
}
button.translate {
  background-color: #4CAF50;
  border: none;
  color: white;
  padding: 1px 2px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  height: 20px;
  width: 20px;
}
</style>

<!--scroll hide tag, get from: http://jsfiddle.net/mariusc23/s6mLJ/31/-->
<style>
.nav-up {
    top: -60px;
}
</style>

<script>
$(document).ready(function() {
  // Hide Header on on scroll down
  var didScroll;
  var lastScrollTop = 0;
  var delta = 5;
  var navbarHeight = $('.tags').outerHeight();

  $(window).scroll(function(event){
      didScroll = true;
  });

  setInterval(function() {
      if (didScroll) {
          hasScrolled();
          didScroll = false;
      }
  }, 250);

  function hasScrolled() {
      var st = $(this).scrollTop();
      
      // Make sure they scroll more than delta
      if(Math.abs(lastScrollTop - st) <= delta)
          return;
      
      // If they scrolled down and are past the navbar, add class .nav-up.
      // This is necessary so you never see what is "behind" the navbar.
      if (st > lastScrollTop && st > navbarHeight){
          // Scroll Down
          $('.tags').addClass('nav-up');
      } else {
          // Scroll Up
          if(st + $(window).height() < $(document).height()) {
              $('.tags').removeClass('nav-up');
          }
      }
      
      lastScrollTop = st;
  }});
</script>

{% capture allcontent %}
{% assign id = page.lesson | prepend: 'l' %}
{% assign lesson = site.data.lessons[id] %}
{% include lesson.html id=id lesson=lesson %}
{% endcapture %}
{{ allcontent | markdownify}}
{{ content }}

